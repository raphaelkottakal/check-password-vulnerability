const sha1 = require('sha1');
const axios = require('axios');

const password = process.argv[2] || 'Password1';

const passwordHash = sha1(password).toUpperCase();
const passwordHashRange = passwordHash.slice(0, 5);
const passwordHashRest = passwordHash.slice(5);

console.log('Testing vulnerability of password: ' + password);
console.log('please wait...');

axios.get('https://api.pwnedpasswords.com/range/' + passwordHashRange)
.then(res => {
  const data = res.data.split('\r\n');
  const finding = data.find(item => item.slice(0, 35) === passwordHashRest);
  if (finding) {
    const timesUsed = finding.slice(36);
    console.log('This password has been found ' + timesUsed + ' times. You better change it.');
  } else {
    console.log('Congratulations your password is not vulnerable!');
  }
})
.catch(err => console.log(err));